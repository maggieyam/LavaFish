{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/tony/Desktop/App_Academy/Mern/menutube/frontend/src/components/posts/post_edit_form.jsx\";\nimport React from 'react';\nimport { withRouter } from 'react-router-dom';\nimport \"react-loader-spinner/dist/loader/css/react-spinner-loader.css\";\nimport 'semantic-ui-css/semantic.min.css';\nimport './create_post_form.css';\nimport './post_edit_form.css';\nimport Loader from 'react-loader-spinner';\nimport { uploadFile } from 'react-s3';\nimport { Dropdown } from 'semantic-ui-react';\n\nconst aws = require('../../config/aws');\n\nconst config = {\n  bucketName: aws.BUCKET_NAME,\n  region: 'us-east-1',\n  accessKeyId: aws.ID,\n  secretAccessKey: aws.SECRET\n};\n\nconst convertStepTimeToSeconds = step => {\n  const {\n    minutes,\n    seconds\n  } = step;\n  step[\"timestamp\"] = parseInt(minutes) * 60 + parseInt(seconds);\n  delete step[\"minutes\"];\n  delete step[\"seconds\"];\n  return step;\n};\n\nconst convertStepTimeToMinutesAndSeconds = step => {\n  const {\n    timestamp\n  } = step;\n  step[\"minutes\"] = Math.floor(timestamp / 60);\n  step[\"seconds\"] = timestamp % 60;\n  delete step[\"timestamp\"];\n  return step;\n};\n\nclass EditPostForm extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      title: \"\",\n      steps: []\n    };\n    this.changeTitle = this.changeTitle.bind(this);\n    this.errors = this.errors.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.loaderSpinner = this.loaderSpinner.bind(this);\n    this.fileLoader = /*#__PURE__*/React.createRef();\n    this.handleTag = this.handleTag.bind(this);\n    this.changeStep = this.changeStep.bind(this);\n    this.addStep = this.addStep.bind(this);\n    this.removeStep = this.removeStep.bind(this);\n  }\n\n  componentDidMount() {\n    this.props.fetchTags();\n    this.props.fetchPost(this.props.match.params.id).then(({\n      post\n    }) => {\n      this.setState({\n        title: post.title,\n        steps: post.steps.map(step => convertStepTimeToMinutesAndSeconds(step))\n      });\n    });\n  }\n\n  changeTitle(e) {\n    e.preventDefault();\n    this.setState({\n      title: e.currentTarget.value\n    });\n  }\n\n  changeStep(e, type, idx) {\n    let {\n      steps\n    } = this.state;\n    steps[idx][type] = e.target.value;\n    this.setState({\n      steps\n    });\n  }\n\n  errors(field) {\n    if (this.props.errors[field]) {\n      return /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"posting-error\",\n        children: this.props.errors[field]\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 14\n      }, this);\n    }\n\n    return;\n  }\n\n  handleTag(e, data) {\n    const bools = {};\n    data.value.map(category => bools[category] = true);\n    this.setState({\n      [data.placeholder.toLowerCase()]: bools\n    });\n  }\n\n  handleSubmit(e) {\n    e.preventDefault();\n    this.props.loadingOn();\n    const editedPost = {\n      title: this.state.title,\n      steps: this.state.steps.map(step => convertStepTimeToSeconds(step))\n    };\n    this.props.editPost(this.props.post._id, editedPost).then(() => {\n      this.props.loadingOff();\n      this.props.clearPostErrors();\n      this.props.history.push(`/show/${this.props.post._id}`);\n    });\n  }\n\n  loaderSpinner() {\n    if (this.props.loading) {\n      return /*#__PURE__*/_jsxDEV(Loader, {\n        type: \"Grid\",\n        color: \"#ee82ee\",\n        height: 100,\n        width: 100\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 9\n      }, this);\n    }\n\n    return;\n  }\n\n  optionify(category) {\n    const options = Object.keys(category).map(tag => {\n      return {\n        key: tag,\n        text: tag[0].toUpperCase() + tag.slice(1),\n        value: tag\n      };\n    });\n    options.pop();\n    return options;\n  }\n\n  addStep() {\n    this.setState({\n      steps: this.state.steps.concat([{\n        description: \"\",\n        minutes: 0,\n        seconds: 0\n      }])\n    });\n  }\n\n  removeStep(e, idx) {\n    e.preventDefault();\n    let {\n      steps\n    } = this.state;\n    steps.splice(idx, 1);\n    this.setState({\n      steps\n    });\n  }\n\n  render() {\n    if (!this.props.diet) return null;\n    const {\n      steps\n    } = this.state;\n\n    const stepsList = /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"steps-input-div\",\n      children: /*#__PURE__*/_jsxDEV(\"label\", {\n        children: [\"Steps:\", steps.map(({\n          minutes,\n          seconds,\n          description\n        }, idx) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"step\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"step-minutes-input\",\n            type: \"number\",\n            max: \"19\",\n            min: \"0\",\n            value: minutes > 9 ? minutes : `0${minutes}`,\n            onChange: e => this.changeStep(e, \"minutes\", idx)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 146,\n            columnNumber: 17\n          }, this), \":\", /*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"step-seconds-input\",\n            type: \"number\",\n            max: \"59\",\n            min: \"0\",\n            value: seconds > 9 ? seconds : `0${seconds}`,\n            onChange: e => this.changeStep(e, \"seconds\", idx)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 151,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"step-description-input\",\n            type: \"text\",\n            maxLength: \"100\",\n            value: description,\n            onChange: e => this.changeStep(e, \"description\", idx)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 156,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: e => this.removeStep(e, idx),\n            children: \"Remove\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 160,\n            columnNumber: 17\n          }, this)]\n        }, idx, true, {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 15\n        }, this)), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          onClick: this.addStep,\n          children: steps.length === 0 ? \"Begin adding steps\" : \"Add another step\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 7\n    }, this);\n\n    return /*#__PURE__*/_jsxDEV(\"form\", {\n      className: \"post-form\",\n      onSubmit: this.handleSubmit,\n      children: [this.loaderSpinner(), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"title-input-div\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"post-title\",\n          children: \"Title:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          id: \"post-title\",\n          type: \"text\",\n          value: this.state.title,\n          onChange: this.changeTitle\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 11\n        }, this), this.errors(\"title\")]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 9\n      }, this), stepsList, /*#__PURE__*/_jsxDEV(\"input\", {\n        id: \"submit-post\",\n        type: \"submit\",\n        value: \"Apply Changes\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default _c = withRouter(EditPostForm);\n\nvar _c;\n\n$RefreshReg$(_c, \"%default%\");","map":{"version":3,"sources":["/Users/tony/Desktop/App_Academy/Mern/menutube/frontend/src/components/posts/post_edit_form.jsx"],"names":["React","withRouter","Loader","uploadFile","Dropdown","aws","require","config","bucketName","BUCKET_NAME","region","accessKeyId","ID","secretAccessKey","SECRET","convertStepTimeToSeconds","step","minutes","seconds","parseInt","convertStepTimeToMinutesAndSeconds","timestamp","Math","floor","EditPostForm","Component","constructor","props","state","title","steps","changeTitle","bind","errors","handleSubmit","loaderSpinner","fileLoader","createRef","handleTag","changeStep","addStep","removeStep","componentDidMount","fetchTags","fetchPost","match","params","id","then","post","setState","map","e","preventDefault","currentTarget","value","type","idx","target","field","data","bools","category","placeholder","toLowerCase","loadingOn","editedPost","editPost","_id","loadingOff","clearPostErrors","history","push","loading","optionify","options","Object","keys","tag","key","text","toUpperCase","slice","pop","concat","description","splice","render","diet","stepsList","length"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { withRouter } from 'react-router-dom';\nimport \"react-loader-spinner/dist/loader/css/react-spinner-loader.css\";\nimport 'semantic-ui-css/semantic.min.css';\nimport './create_post_form.css';\nimport './post_edit_form.css';\nimport Loader from 'react-loader-spinner';\nimport { uploadFile } from 'react-s3';\nimport { Dropdown } from 'semantic-ui-react';\nconst aws = require('../../config/aws');\n\nconst config = {\n  bucketName: aws.BUCKET_NAME,\n  region: 'us-east-1',\n  accessKeyId: aws.ID,\n  secretAccessKey: aws.SECRET,\n}\n\nconst convertStepTimeToSeconds = step => {\n  const { minutes, seconds } = step;\n  step[\"timestamp\"] = (parseInt(minutes) * 60) + parseInt(seconds); \n  delete step[\"minutes\"];\n  delete step[\"seconds\"];\n  return step;\n}\n\nconst convertStepTimeToMinutesAndSeconds = step => {\n  const { timestamp } = step;\n  step[\"minutes\"] = Math.floor(timestamp / 60);\n  step[\"seconds\"] = timestamp % 60;\n  delete step[\"timestamp\"];\n  return step;\n}\n\nclass EditPostForm extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      title: \"\",\n      steps: []\n    }\n    this.changeTitle = this.changeTitle.bind(this);\n    this.errors = this.errors.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.loaderSpinner = this.loaderSpinner.bind(this);\n    this.fileLoader = React.createRef();\n    this.handleTag = this.handleTag.bind(this);\n    this.changeStep = this.changeStep.bind(this);\n    this.addStep = this.addStep.bind(this);\n    this.removeStep = this.removeStep.bind(this);\n  }\n\n  componentDidMount() {\n    this.props.fetchTags();\n    this.props.fetchPost(this.props.match.params.id).then(({post}) => {\n      this.setState({\n        title: post.title,\n        steps: post.steps.map(step => convertStepTimeToMinutesAndSeconds(step))\n      })\n    });\n  }\n\n  changeTitle(e) {\n    e.preventDefault();\n    this.setState({ title: e.currentTarget.value });\n  }\n\n  changeStep(e, type, idx) {\n    let { steps } = this.state;\n    steps[idx][type] = e.target.value;\n    this.setState({ steps });\n  }\n\n  errors(field) {\n    if (this.props.errors[field]) {\n      return <p className=\"posting-error\">{this.props.errors[field]}</p>\n    }\n    return\n  }\n\n  handleTag(e, data) {\n    const bools = {};\n    data.value.map(category => bools[category] = true);\n    this.setState({ [data.placeholder.toLowerCase()]: bools })\n  }\n\n  handleSubmit(e) {\n    e.preventDefault();\n\n    this.props.loadingOn();\n    const editedPost = {\n      title: this.state.title,\n      steps: this.state.steps.map(step => convertStepTimeToSeconds(step))\n    }\n    this.props.editPost(this.props.post._id, editedPost).then(() => {\n      this.props.loadingOff();\n      this.props.clearPostErrors();\n      this.props.history.push(`/show/${this.props.post._id}`);\n    })\n  }\n\n  loaderSpinner() {\n    if (this.props.loading) {\n      return (\n        <Loader type=\"Grid\" color=\"#ee82ee\" height={100} width={100} />\n      )\n    }\n    return\n  }\n\n  optionify(category) {\n    const options = Object.keys(category).map(tag => {\n      return { key: tag, text: tag[0].toUpperCase() + tag.slice(1), value: tag }\n    })\n    options.pop();\n    return options\n  }\n\n  addStep() {\n    this.setState({\n      steps: this.state.steps.concat([{\n        description: \"\",\n        minutes: 0,\n        seconds: 0\n      }])\n    })\n  }\n\n  removeStep(e, idx) {\n    e.preventDefault();\n    let { steps } = this.state;\n    steps.splice(idx, 1);\n    this.setState({ steps });\n  }\n\n  render() {\n    if (!this.props.diet) return null;\n    \n    const { steps } = this.state;\n    const stepsList = (\n      <div className=\"steps-input-div\">\n          <label>Steps:\n          {steps.map(({minutes, seconds, description}, idx) => (\n              <div key={idx} className=\"step\">\n                <input className=\"step-minutes-input\"\n                  type=\"number\" max=\"19\" min=\"0\"\n                  value={minutes > 9 ? minutes : `0${minutes}`}\n                  onChange={e => this.changeStep(e, \"minutes\", idx)}/>\n                :\n                <input className=\"step-seconds-input\"\n                  type=\"number\" max=\"59\" min=\"0\"\n                  value={seconds > 9 ? seconds : `0${seconds}`}\n                  onChange={e => this.changeStep(e, \"seconds\", idx)}\n                />\n                <input className=\"step-description-input\"\n                  type=\"text\" maxLength=\"100\" value={description}\n                  onChange={e => this.changeStep(e, \"description\", idx)}\n                />\n                <button type=\"button\" onClick={e => this.removeStep(e, idx)}>\n                  Remove\n                </button>\n              </div>\n            )\n          )}\n          <button type=\"button\" onClick={this.addStep}>\n            {steps.length === 0 ? \"Begin adding steps\" : \"Add another step\"}\n          </button>\n        </label>\n      </div>\n    )\n    \n    return (\n      <form className=\"post-form\" onSubmit={this.handleSubmit}>\n        {this.loaderSpinner()}\n\n        <div className=\"title-input-div\">\n          <label htmlFor=\"post-title\">Title:</label>\n          <input\n            id=\"post-title\"\n            type=\"text\"\n            value={this.state.title}\n            onChange={this.changeTitle} />\n          {this.errors(\"title\")}\n        </div>\n        {stepsList}\n        <input id=\"submit-post\" type=\"submit\" value=\"Apply Changes\" />\n      </form>\n    )\n  }\n\n}\n\nexport default withRouter(EditPostForm);"]},"metadata":{},"sourceType":"module"}